# Tesla CRC Analysis

## Status & News

### 2025-04-04: Calculation for the 0x229 works

We use a table of magic patterns, this is 16 bytes long, and the alive counter is the index in this table.
We simply fill the table with the known CRC values in idle position.
As soon as a button is actuated, the CRC changes by a specific XOR delta. Each button has a specific delta. The delta is the same for all possible 16 message counter values. This behavior is typical for a CRC. So it could be possible, to replace the currently implemented `if button then xorPattern = something` by a real CRC calculation.

Test result: The program gives the same numbers as listed in https://openinverter.org/forum/viewtopic.php?p=81258#p81258

```
uwemi@DESKTOP-OKFJ35V MINGW64 /c/UwesTechnik/tesla-crc
$ gcc tesla-crc.c

uwemi@DESKTOP-OKFJ35V MINGW64 /c/UwesTechnik/tesla-crc
$ ./a.exe
Tesla CRC analysis
Idle position
0x46 0x00 0x00
0x44 0x01 0x00
0x52 0x02 0x00
0x6d 0x03 0x00
0x43 0x04 0x00
0x41 0x05 0x00
0xdd 0x06 0x00
0xf9 0x07 0x00
0x4c 0x08 0x00
0xa5 0x09 0x00
0xf6 0x0a 0x00
0x8c 0x0b 0x00
0x49 0x0c 0x00
0x2f 0x0d 0x00
0x31 0x0e 0x00
0x3b 0x0f 0x00
Full down
0xb7 0x40 0x00
0xb5 0x41 0x00
0xa3 0x42 0x00
0x9c 0x43 0x00
0xb2 0x44 0x00
0xb0 0x45 0x00
0x2c 0x46 0x00
0x08 0x47 0x00
0xbd 0x48 0x00
0x54 0x49 0x00
0x07 0x4a 0x00
0x7d 0x4b 0x00
0xb8 0x4c 0x00
0xde 0x4d 0x00
0xc0 0x4e 0x00
0xca 0x4f 0x00
park button
0xaf 0x00 0x01
0xad 0x01 0x01
0xbb 0x02 0x01
0x84 0x03 0x01
0xaa 0x04 0x01
0xa8 0x05 0x01
0x34 0x06 0x01
0x10 0x07 0x01
0xa5 0x08 0x01
0x4c 0x09 0x01
0x1f 0x0a 0x01
0x65 0x0b 0x01
0xa0 0x0c 0x01
0xc6 0x0d 0x01
0xd8 0x0e 0x01
0xd2 0x0f 0x01
Full up
0xa9 0x20 0x00
0xab 0x21 0x00
0xbd 0x22 0x00
0x82 0x23 0x00
0xac 0x24 0x00
0xae 0x25 0x00
0x32 0x26 0x00
0x16 0x27 0x00
0xa3 0x28 0x00
0x4a 0x29 0x00
0x19 0x2a 0x00
0x63 0x2b 0x00
0xa6 0x2c 0x00
0xc0 0x2d 0x00
0xde 0x2e 0x00
0xd4 0x2f 0x00
Half down
0x49 0x30 0x00
0x4b 0x31 0x00
0x5d 0x32 0x00
0x62 0x33 0x00
0x4c 0x34 0x00
0x4e 0x35 0x00
0xd2 0x36 0x00
0xf6 0x37 0x00
0x43 0x38 0x00
0xaa 0x39 0x00
0xf9 0x3a 0x00
0x83 0x3b 0x00
0x46 0x3c 0x00
0x20 0x3d 0x00
0x3e 0x3e 0x00
0x34 0x3f 0x00

```

## Open Todos

* [ ] Does the same algorithm also work for the other side?
* [ ] Find the CRC polynoms and replace the if-then by a real CRC calculation.
* [ ] Can the array of magic bytes also be calculated?

## References

* Ref1: Data of the 0x229 stalk: https://openinverter.org/forum/viewtopic.php?p=81258#p81258
* Ref2: Logs with many combinations, for left and right stalk: https://openinverter.org/forum/viewtopic.php?p=81331#p81331
* Ref3: Simple addition for 0x313: https://openinverter.org/forum/viewtopic.php?p=77694#p77694
